<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script src="../Navbar/loadnavbar.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="vis3.css">
    <script src="../lib/d3.v4/d3.v4.js"></script>
    <title>Visualization 3</title>
    <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <div id="navbar-container"></div>
    <div class="vis-holder">
        <div class="map-title">
            <label for="country-select">Country:</label>
            <select id="country-select"></select>

            <label for="year-select">Year:</label>
            <select id="year-select">
                <option value="2019">2019</option>
                <option value="2018">2018</option>
                <option value="2017">2017</option>
                <option value="2016">2016</option>
                <option value="2015">2015</option>
                <option value="2014">2014</option>
            </select>

            <label for="data-type-select">Data Type:</label>
            <select id="data-type-select">
                <option value="AlcoholConsumption">Alcohol Consumption</option> 
                <option value="TotalDeaths">Total Deaths</option>
            </select>

            <div id="map-container">
                <div id="map"></div>
            </div>
            <div class="map-holder" id="map-container">
                <svg id="vis-svg"></svg>
            </div>
            <div id="data-summary" class="data-summary">
                <p id="summary-text"></p> 
            </div>            
        </div>

        <div id="summary-container" style="text-align: center; margin-top: 20px;">
            <p id="summary-text" style="font-size: 18px; font-family: 'Raleway'; color: white; text-align: center;"></p>
        </div>

        <script src="https://unpkg.com/topojson-client@3"></script>
        <script src="Worldmap/worldmap.js"></script>
    </div>

    <script>
        // Predefined list of countries
        const countries = [
            'Afghanistan', 'Albania', 'Algeria', 'Angola', 'Argentina', 'Armenia', 
            'Australia', 'Austria', 'Azerbaijan', 'Bahamas', 'Bangladesh', 'Belarus', 
            'Belgium', 'Belize', 'Benin', 'Bhutan', 'Bolivia', 'Bosnia and Herz.', 
            'Botswana', 'Brazil', 'Brunei', 'Bulgaria', 'Burkina Faso', 'Burundi', 
            'Cambodia', 'Cameroon', 'Canada', 'Central African Rep.', 'Chad', 'Chile', 
            'China', 'Colombia', 'Congo', 'Costa Rica', 'Croatia', 'Cuba', 'Cyprus', 
            'Czechia', "CÃ´te d'Ivoire", 'Dem. Rep. Congo', 'Denmark', 'Djibouti', 
            'Dominican Rep.', 'Ecuador', 'Egypt', 'El Salvador', 'Eq. Guinea', 
            'Eritrea', 'Estonia', 'Ethiopia', 'Falkland Is.', 'Fiji', 'Finland', 
            'France', 'Gabon', 'Gambia', 'Georgia', 'Germany', 'Ghana', 'Greece', 
            'Greenland', 'Guatemala', 'Guinea', 'Guinea-Bissau', 'Guyana', 'Haiti', 
            'Honduras', 'Hungary', 'Iceland', 'India', 'Indonesia', 'Iran', 'Iraq', 
            'Ireland', 'Israel', 'Italy', 'Jamaica', 'Japan', 'Jordan', 'Kazakhstan', 
            'Kenya', 'Kosovo', 'Kuwait', 'Kyrgyzstan', 'Laos', 'Latvia', 'Lebanon', 
            'Lesotho', 'Liberia', 'Libya', 'Lithuania', 'Luxembourg', 'Madagascar', 
            'Malawi', 'Malaysia', 'Mali', 'Mauritania', 'Mexico', 'Moldova', 
            'Mongolia', 'Montenegro', 'Morocco', 'Mozambique', 'Myanmar', 'N. Cyprus', 
            'Namibia', 'Nepal', 'Netherlands', 'New Caledonia', 'New Zealand', 
            'Nicaragua', 'Niger', 'Nigeria', 'North Korea', 'North Macedonia', 
            'Norway', 'Oman', 'Pakistan', 'Palestine', 'Panama', 'Papua New Guinea', 
            'Paraguay', 'Peru', 'Philippines', 'Poland', 'Portugal', 'Puerto Rico', 
            'Qatar', 'Romania', 'Russia', 'Rwanda', 'S. Sudan', 'Saudi Arabia', 
            'Senegal', 'Serbia', 'Sierra Leone', 'Slovakia', 'Slovenia', 'Solomon Is.', 
            'Somalia', 'Somaliland', 'South Africa', 'South Korea', 'Spain', 
            'Sri Lanka', 'Sudan', 'Suriname', 'Sweden', 'Switzerland', 'Syria', 
            'Taiwan', 'Tajikistan', 'Tanzania', 'Thailand', 'Timor-Leste', 'Togo', 
            'Trinidad and Tobago', 'Tunisia', 'Turkey', 'Turkmenistan', 'Uganda', 
            'Ukraine', 'United Arab Emirates', 'United Kingdom', 'United States of America', 
            'Uruguay', 'Uzbekistan', 'Vanuatu', 'Venezuela', 'Vietnam', 'W. Sahara', 
            'Yemen', 'Zambia', 'Zimbabwe', 'eSwatini'
        ];

        // Populate country dropdown
        const countrySelect = document.getElementById("country-select");
        countries.forEach(country => {
            const option = document.createElement("option");
            option.value = country;
            option.textContent = country;
            countrySelect.appendChild(option);
        });

        // File path to data
        const dataFilePath = "../data/vis3_data.csv";

        // Function to fetch data
        async function fetchData() {
            const response = await fetch(dataFilePath);
            const data = await response.text();
            const rows = data.split("\n").slice(1); // Remove headers
            return rows.map(row => {
                const [Country, Year, AlcoholConsumption, TotalDeaths] = row.split(",");
                return { 
                    Country, 
                    Year, 
                    AlcoholConsumption: parseFloat(AlcoholConsumption), 
                    TotalDeaths: parseFloat(TotalDeaths) 
                };
            });
        }

        // Function to update the summary text
        async function updateSummary() {
            const country = document.getElementById("country-select").value;
            const year = document.getElementById("year-select").value;
            const dataType = document.getElementById("data-type-select").value;

            const data = await fetchData();
            const filteredData = data.find(d => d.Country === country && d.Year === year);

            const summaryText = document.getElementById("summary-text");
            if (filteredData) {
                if (dataType === "AlcoholConsumption") {
                    summaryText.textContent = `In ${year}, alcohol, recorded per capita (15+ years) consumption (in liters of pure alcohol) was ${filteredData.AlcoholConsumption}.`;
                } else if (dataType === "TotalDeaths") {
                    summaryText.textContent = `In ${year}, the total number of deaths recorded was ${filteredData.TotalDeaths}.`;
                } else {
                    summaryText.textContent = "Data type not supported yet.";
                }
            } else {
                summaryText.textContent = "No data available for the selected country and year.";
            }
        }

        // Event listeners for dropdown changes
        document.getElementById("country-select").addEventListener("change", updateSummary);
        document.getElementById("year-select").addEventListener("change", updateSummary);
        document.getElementById("data-type-select").addEventListener("change", updateSummary);

        // Initial call to display data when the page loads
        updateSummary();
    </script>
</body>
</html>
